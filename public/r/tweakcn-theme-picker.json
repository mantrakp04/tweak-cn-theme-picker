{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "tweakcn-theme-picker",
  "type": "registry:component",
  "title": "TweakCN Theme Picker",
  "description": "A dropdown menu for selecting and previewing TweakCN themes with light/dark mode toggle.",
  "registryDependencies": [
    "button",
    "dropdown-menu",
    "tweakcn-theme-provider"
  ],
  "files": [
    {
      "path": "registry/new-york/blocks/tweakcn-theme-picker/tweakcn-theme-picker.tsx",
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport { useTheme } from \"next-themes\"\nimport {\n  Check,\n  Import,\n  Laptop,\n  Loader2,\n  Moon,\n  Palette,\n  Search,\n  Shuffle,\n  Sun,\n  Trash2,\n  X,\n} from \"lucide-react\"\nimport { Button } from \"@/registry/new-york/ui/button\"\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuTrigger,\n} from \"@/registry/new-york/ui/dropdown-menu\"\nimport { Input } from \"@/registry/new-york/ui/input\"\nimport { cn } from \"@/lib/utils\"\nimport { useTweakCNThemes } from \"@/registry/new-york/blocks/tweakcn-theme-provider/theme-provider\"\nimport { fetchTheme, fetchThemes, type Theme } from \"@/registry/new-york/blocks/tweakcn-theme-provider/lib/tweakcn\"\n\ninterface SavedThemeEntry {\n  url: string\n  theme: Theme\n}\n\ninterface ThemePickerProps {\n  themes?: Theme[]\n  className?: string\n}\n\nconst SAVED_THEMES_KEY = \"tweakcn-saved-themes\"\n\nfunction getSavedThemes(): SavedThemeEntry[] {\n  if (typeof window === \"undefined\") return []\n  try {\n    const saved = localStorage.getItem(SAVED_THEMES_KEY)\n    return saved ? JSON.parse(saved) : []\n  } catch {\n    return []\n  }\n}\n\nfunction saveSavedThemes(themes: SavedThemeEntry[]) {\n  if (typeof window === \"undefined\") return\n  localStorage.setItem(SAVED_THEMES_KEY, JSON.stringify(themes))\n}\n\nfunction formatThemeName(name: string): string {\n  return name\n    .replace(/-/g, \" \")\n    .replace(/^\\w/, (char) => char.toUpperCase())\n}\n\nfunction ThemeColorDots({ theme }: { theme: Theme }) {\n  const colors = [\n    theme.cssVars.light.primary || \"oklch(0.5 0.2 250)\",\n    theme.cssVars.light.secondary || \"oklch(0.9 0.02 250)\",\n    theme.cssVars.light.accent || \"oklch(0.95 0.02 250)\",\n    theme.cssVars.light.muted || \"oklch(0.95 0.01 250)\",\n  ]\n\n  return (\n    <div className=\"flex items-center gap-0.5\">\n      {colors.map((color, i) => (\n        <div\n          key={i}\n          className=\"h-3 w-3 rounded-full border border-border/50\"\n          style={{ background: color }}\n        />\n      ))}\n    </div>\n  )\n}\n\nexport function ThemePicker({\n  themes: additionalThemes = [],\n  className,\n}: ThemePickerProps) {\n  const { currentTheme, setTheme: setTweakCNTheme } = useTweakCNThemes()\n  const { theme: themeMode, setTheme: setThemeMode } = useTheme()\n  const [isOpen, setIsOpen] = React.useState(false)\n  const [mounted, setMounted] = React.useState(false)\n  const [searchQuery, setSearchQuery] = React.useState(\"\")\n  const [showImport, setShowImport] = React.useState(false)\n  const [importUrl, setImportUrl] = React.useState(\"\")\n  const [isImporting, setIsImporting] = React.useState(false)\n  const [importError, setImportError] = React.useState<string | null>(null)\n  const [savedThemes, setSavedThemes] = React.useState<SavedThemeEntry[]>([])\n  const [fetchedThemes, setFetchedThemes] = React.useState<Theme[]>([])\n  const [isLoadingThemes, setIsLoadingThemes] = React.useState(true)\n\n  React.useEffect(() => {\n    setMounted(true)\n    setSavedThemes(getSavedThemes())\n    \n    // Fetch themes internally\n    fetchThemes()\n      .then(setFetchedThemes)\n      .catch((error) => {\n        console.error(\"Failed to load themes:\", error)\n        setFetchedThemes([])\n      })\n      .finally(() => {\n        setIsLoadingThemes(false)\n      })\n  }, [])\n\n  // Combine fetched themes with additional themes provided by user\n  const themes = React.useMemo(() => {\n    const allThemes = [...fetchedThemes, ...additionalThemes]\n    // Remove duplicates based on theme name\n    const uniqueThemes = allThemes.reduce((acc, theme) => {\n      if (!acc.find(t => t.name === theme.name)) {\n        acc.push(theme)\n      }\n      return acc\n    }, [] as Theme[])\n    return uniqueThemes\n  }, [fetchedThemes, additionalThemes])\n\n  const handleThemeSelect = (theme: Theme) => {\n    setTweakCNTheme(theme)\n  }\n\n  const handleRandomTheme = () => {\n    const allThemes = [...themes, ...savedThemes.map(s => s.theme)]\n    if (allThemes.length === 0) return\n    const randomIndex = Math.floor(Math.random() * allThemes.length)\n    setTweakCNTheme(allThemes[randomIndex])\n  }\n\n  const handleClearTheme = () => {\n    setTweakCNTheme(null)\n  }\n\n  const handleImportTheme = async () => {\n    if (!importUrl.trim()) return\n\n    setIsImporting(true)\n    setImportError(null)\n\n    try {\n      const url = new URL(importUrl.trim())\n      if (!url.hostname.includes(\"tweakcn.com\")) {\n        throw new Error(\"Only tweakcn.com URLs are supported\")\n      }\n\n      if (savedThemes.some(s => s.url === importUrl.trim())) {\n        throw new Error(\"Theme already imported\")\n      }\n\n      const theme = await fetchTheme(importUrl.trim())\n      const newEntry: SavedThemeEntry = { url: importUrl.trim(), theme }\n      const updated = [...savedThemes, newEntry]\n      setSavedThemes(updated)\n      saveSavedThemes(updated)\n      setImportUrl(\"\")\n      setShowImport(false)\n    } catch (err) {\n      setImportError(err instanceof Error ? err.message : \"Failed to import theme\")\n    } finally {\n      setIsImporting(false)\n    }\n  }\n\n  const handleDeleteSavedTheme = (url: string, e: React.MouseEvent) => {\n    e.stopPropagation()\n    const updated = savedThemes.filter(s => s.url !== url)\n    setSavedThemes(updated)\n    saveSavedThemes(updated)\n  }\n\n  const filteredThemes = themes.filter((theme) =>\n    theme.name.toLowerCase().includes(searchQuery.toLowerCase())\n  )\n\n  const filteredSavedThemes = savedThemes.filter((entry) =>\n    entry.theme.name.toLowerCase().includes(searchQuery.toLowerCase())\n  )\n\n  const totalThemes = filteredThemes.length + filteredSavedThemes.length\n  const normalizedThemeMode =\n    themeMode === \"light\" || themeMode === \"dark\" || themeMode === \"system\"\n      ? themeMode\n      : \"system\"\n\n  const nextThemeMode =\n    normalizedThemeMode === \"system\"\n      ? \"light\"\n      : normalizedThemeMode === \"light\"\n        ? \"dark\"\n        : \"system\"\n\n  const themeModeLabel =\n    normalizedThemeMode === \"system\"\n      ? \"System\"\n      : normalizedThemeMode === \"light\"\n        ? \"Light\"\n        : \"Dark\"\n\n  if (!mounted || isLoadingThemes) {\n    return (\n      <Button variant=\"outline\" size=\"sm\" className={cn(\"gap-2\", className)} disabled>\n        <Palette className=\"h-4 w-4\" />\n        Loading...\n      </Button>\n    )\n  }\n\n  return (\n    <DropdownMenu open={isOpen} onOpenChange={setIsOpen}>\n      <DropdownMenuTrigger asChild>\n        <Button variant=\"outline\" size=\"sm\" className={cn(\"gap-2\", className)}>\n          <Palette className=\"h-4 w-4\" />\n          {currentTheme ? formatThemeName(currentTheme.name) : \"Theme\"}\n        </Button>\n      </DropdownMenuTrigger>\n      <DropdownMenuContent align=\"end\" className=\"w-[280px] p-0\">\n        {/* Search Input */}\n        <div className=\"p-2 border-b border-border\">\n          <div className=\"relative\">\n            <Search className=\"absolute left-2.5 top-1/2 -translate-y-1/2 h-3.5 w-3.5 text-muted-foreground\" />\n            <Input\n              placeholder=\"Search themes...\"\n              value={searchQuery}\n              onChange={(e) => setSearchQuery(e.target.value)}\n              className=\"h-8 pl-8 text-sm\"\n              onClick={(e) => e.stopPropagation()}\n            />\n          </div>\n        </div>\n\n        {/* Header with count and random button */}\n        <div className=\"flex items-center justify-between px-3 py-2 border-b border-border\">\n          <span className=\"text-sm text-muted-foreground\">\n            {totalThemes} themes\n          </span>\n          <div className=\"flex items-center gap-1\">\n            <button\n              onClick={(e) => {\n                e.stopPropagation()\n                setThemeMode(nextThemeMode)\n              }}\n              className=\"p-1 rounded hover:bg-accent text-muted-foreground hover:text-foreground transition-colors\"\n              title={`Theme: ${themeModeLabel} (click to switch)`}\n              aria-label={`Theme: ${themeModeLabel}. Click to switch.`}\n              type=\"button\"\n            >\n              {normalizedThemeMode === \"dark\" ? (\n                <Moon className=\"h-4 w-4\" />\n              ) : normalizedThemeMode === \"light\" ? (\n                <Sun className=\"h-4 w-4\" />\n              ) : (\n                <Laptop className=\"h-4 w-4\" />\n              )}\n            </button>\n            {currentTheme && (\n              <button\n                onClick={(e) => {\n                  e.stopPropagation()\n                  handleClearTheme()\n                }}\n                className=\"p-1 rounded hover:bg-accent text-muted-foreground hover:text-foreground transition-colors\"\n                title=\"Clear theme\"\n                aria-label=\"Clear current theme\"\n                type=\"button\"\n              >\n                <X className=\"h-4 w-4\" />\n              </button>\n            )}\n            <button\n              onClick={(e) => {\n                e.stopPropagation()\n                handleRandomTheme()\n              }}\n              className=\"p-1 rounded hover:bg-accent text-muted-foreground hover:text-foreground transition-colors\"\n              title=\"Random theme\"\n              aria-label=\"Randomize theme\"\n              type=\"button\"\n            >\n              <Shuffle className=\"h-4 w-4\" />\n            </button>\n          </div>\n        </div>\n\n        {/* Saved Themes Section */}\n        <div className=\"px-3 py-2 border-b border-border\">\n          {!showImport ? (\n            <div className=\"flex items-center justify-between\">\n              {savedThemes.length === 0 ? (\n                <p className=\"text-xs text-muted-foreground\">\n                  <a\n                    href=\"https://tweakcn.com/editor/theme\"\n                    target=\"_blank\"\n                    rel=\"noopener noreferrer\"\n                    className=\"text-foreground hover:underline\"\n                    onClick={(e) => e.stopPropagation()}\n                  >\n                    Import\n                  </a>{\" \"}\n                  a theme to find it here.\n                </p>\n              ) : (\n                <p className=\"text-xs font-medium text-muted-foreground\">\n                  Saved Themes\n                </p>\n              )}\n              <button\n                onClick={(e) => {\n                  e.stopPropagation()\n                  setShowImport(true)\n                  setImportError(null)\n                }}\n                className=\"flex items-center gap-1 px-2 py-1 text-xs rounded hover:bg-accent text-muted-foreground hover:text-foreground transition-colors\"\n              >\n                <Import className=\"h-3 w-3\" />\n                Import\n              </button>\n            </div>\n          ) : (\n            <div className=\"space-y-2\" onClick={(e) => e.stopPropagation()}>\n              <div className=\"flex items-center justify-between\">\n                <p className=\"text-xs font-medium text-muted-foreground\">\n                  Import Theme URL\n                </p>\n                <button\n                  onClick={() => {\n                    setShowImport(false)\n                    setImportUrl(\"\")\n                    setImportError(null)\n                  }}\n                  className=\"p-0.5 rounded hover:bg-accent text-muted-foreground hover:text-foreground transition-colors\"\n                >\n                  <X className=\"h-3.5 w-3.5\" />\n                </button>\n              </div>\n              <Input\n                placeholder=\"https://tweakcn.com/r/themes/...\"\n                value={importUrl}\n                onChange={(e) => setImportUrl(e.target.value)}\n                className=\"h-7 text-xs\"\n                onKeyDown={(e) => {\n                  if (e.key === \"Enter\") {\n                    e.preventDefault()\n                    handleImportTheme()\n                  }\n                }}\n              />\n              {importError && (\n                <p className=\"text-xs text-destructive\">{importError}</p>\n              )}\n              <Button\n                size=\"sm\"\n                className=\"w-full h-7 text-xs\"\n                onClick={handleImportTheme}\n                disabled={isImporting || !importUrl.trim()}\n              >\n                {isImporting ? (\n                  <>\n                    <Loader2 className=\"h-3 w-3 mr-1 animate-spin\" />\n                    Importing...\n                  </>\n                ) : (\n                  \"Import Theme\"\n                )}\n              </Button>\n            </div>\n          )}\n\n          {/* Saved Themes List */}\n          {savedThemes.length > 0 && !showImport && (\n            <div className=\"mt-2 space-y-0.5\">\n              {filteredSavedThemes.map((entry) => {\n                const isSelected = currentTheme?.name === entry.theme.name\n                return (\n                  <div\n                    key={entry.url}\n                    onClick={() => handleThemeSelect(entry.theme)}\n                    className={cn(\n                      \"relative flex items-center gap-2 px-1 py-1.5 rounded-sm cursor-pointer text-sm group\",\n                      \"hover:bg-secondary/50 transition-colors\",\n                      isSelected && \"bg-accent text-accent-foreground\"\n                    )}\n                  >\n                    <ThemeColorDots theme={entry.theme} />\n                    <span className=\"flex-1 truncate text-xs\">{formatThemeName(entry.theme.name)}</span>\n                    {isSelected ? (\n                      <Check className=\"h-3.5 w-3.5 shrink-0\" />\n                    ) : (\n                      <button\n                        onClick={(e) => handleDeleteSavedTheme(entry.url, e)}\n                        className=\"p-0.5 rounded opacity-0 group-hover:opacity-100 hover:bg-destructive/20 text-muted-foreground hover:text-destructive transition-all\"\n                        title=\"Remove theme\"\n                      >\n                        <Trash2 className=\"h-3 w-3\" />\n                      </button>\n                    )}\n                  </div>\n                )\n              })}\n            </div>\n          )}\n        </div>\n\n        {/* Built-in Themes Section */}\n        <div className=\"px-2 py-1.5\">\n          <p className=\"px-1 mb-1 text-xs font-medium text-muted-foreground\">\n            Built-in Themes\n          </p>\n        </div>\n\n        <div className=\"max-h-[300px] overflow-y-auto pb-1\">\n          {filteredThemes.map((theme) => {\n            const isSelected = currentTheme?.name === theme.name\n            return (\n              <div\n                key={theme.name}\n                onClick={() => handleThemeSelect(theme)}\n                className={cn(\n                  \"relative flex items-center gap-2 px-2 py-2 mx-1 rounded-sm cursor-pointer text-sm\",\n                  \"hover:bg-secondary/50 transition-colors\",\n                  isSelected && \"bg-accent text-accent-foreground\"\n                )}\n              >\n                <ThemeColorDots theme={theme} />\n                <span className=\"flex-1 truncate\">{formatThemeName(theme.name)}</span>\n                {isSelected && (\n                  <Check className=\"h-4 w-4 shrink-0\" />\n                )}\n              </div>\n            )\n          })}\n\n          {filteredThemes.length === 0 && filteredSavedThemes.length === 0 && (\n            <div className=\"py-6 text-center text-sm text-muted-foreground\">\n              No themes found\n            </div>\n          )}\n        </div>\n      </DropdownMenuContent>\n    </DropdownMenu>\n  )\n}\n",
      "type": "registry:component"
    }
  ]
}